{% extends "shop/base.html" %}

{% block content %}
    <br><br>
    <div class="row">
        <div class="col-md-6">
            <div>
                <img width="500px" height="500px" src="{{product.image}}" alt="image de l'article">
            </div>
        </div>
        <div class="col-md-6">
            <div class="text-warning display-3">
                {{product.title}}
            </div> 
            <br> 
            <div class="badge badge-warning rounded-pill bg-dark text-warning" style="color: black; padding: 15px; font-size: large;">
                <br>
                Prix : <span id="price{{product.id}}">{{product.price}}</span> FCFA
                <br>
            </div>
            <div style="color: white; padding: 15px; font-size: large;">
                <br>
                {{product.description}}
            </div>
            <br>
            <button id="{{product.id}}" class="btn ted btn-success" data-image="{{ product.image }}">Ajouter</button>
        </div>
    </div>
    <br><br>
{% endblock %}

{% block js %}
    <script type="text/javascript">
        if(localStorage.getItem('panier') == null){
            var panier = {};
        } else {
            panier = JSON.parse(localStorage.getItem('panier'));
        }

        function updatePanierCount() {
            document.getElementById("panier").innerHTML = "Panier = " + Object.keys(panier).length;
        }

        updatePanierCount();

        $(document).on('click', '.ted', function(){
            var item_id = this.id.toString();
            var imageUrl = $(this).data('image')
            console.log(item_id);
            if(panier[item_id] != undefined){
                var quantite = panier[item_id][0] + 1;
                panier[item_id][0] = quantite;
                panier[item_id][2] += parseFloat(document.getElementById('price' + item_id).innerHTML);
            } else {
                var quantite = 1;
                var prix = parseFloat(document.getElementById('price' + item_id).innerHTML);
                var nom = document.getElementById("aa" + item_id).innerHTML; // Assurez-vous d'avoir cet élément
                panier[item_id] = [quantite, nom, prix];
            }
            console.log(panier);
            localStorage.setItem('panier', JSON.stringify(panier));

            updatePanierCount();
        });

        AfficherList(panier);

        function AfficherList(panier){
            var panierString = "";
            var index = 1;
            for(var x in panier){
                panierString += "Article " + index + " : ";
                panierString += document.getElementById("aa" + x).innerHTML + " : Quantité = " + panier[x][0] + "<br>";
                index++;
            }

            $('[data-toggle="popover"]').popover();
            document.getElementById("panier").setAttribute('data-content', panierString);
        }
    </script>
{% endblock %}